<div class="cards-container">
  <!-- Vista de Lista -->
  @if (viewMode() === 'list') {
    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <h1>Tarjetas</h1>
        <p class="subtitle">{{ cards().length }} tarjetas registradas</p>
      </div>
      <button class="btn btn-primary" (click)="onAddCard()">
        <mat-icon>add</mat-icon>
        Agregar Tarjeta
      </button>
    </div>

    @if (loading()) {
      <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Cargando tarjetas...</p>
      </div>
    } @else {
      <div class="cards-content">
        <!-- Balance Cards - Mismo estilo que dashboard -->
        <div class="balance-cards">
          <div class="balance-card">
            <div class="balance-icon">
              <mat-icon>credit_card</mat-icon>
            </div>
            <div class="balance-info">
              <span class="balance-label">Crédito</span>
              <span class="balance-amount">{{ creditCards().length }}</span>
            </div>
          </div>

          <div class="balance-card">
            <div class="balance-icon">
              <mat-icon>payment</mat-icon>
            </div>
            <div class="balance-info">
              <span class="balance-label">Débito</span>
              <span class="balance-amount">{{ debitCards().length }}</span>
            </div>
          </div>

          <div class="balance-card">
            <div class="balance-icon">
              <mat-icon>check_circle</mat-icon>
            </div>
            <div class="balance-info">
              <span class="balance-label">Activas</span>
              <span class="balance-amount">{{ activeCards().length }}</span>
            </div>
          </div>
        </div>

        <!-- Filtro Simple - Usa .tabs-container del sistema -->
        <div class="tabs-container">
          <div class="tabs">
            <button 
              class="tab"
              [class.active]="selectedTabIndex() === 0"
              (click)="onTabChanged(0)">
              <mat-icon>credit_card</mat-icon>
              Todas
            </button>
            <button 
              class="tab"
              [class.active]="selectedTabIndex() === 1"
              (click)="onTabChanged(1)">
              <mat-icon>credit_card</mat-icon>
              Crédito
            </button>
            <button 
              class="tab"
              [class.active]="selectedTabIndex() === 2"
              (click)="onTabChanged(2)">
              <mat-icon>payment</mat-icon>
              Débito
            </button>
            <button 
              class="tab"
              [class.active]="selectedTabIndex() === 3"
              (click)="onTabChanged(3)">
              <mat-icon>check_circle</mat-icon>
              Activas
            </button>
          </div>
        </div>

        <!-- Lista de Tarjetas -->
        <div class="cards-list-container">
          @if (selectedTabIndex() === 0) {
            @if (cards().length === 0) {
              <div class="empty-state">
                <mat-icon class="empty-icon">credit_card_off</mat-icon>
                <h3>No tienes tarjetas</h3>
                <p>Agrega tu primera tarjeta para comenzar</p>
                <button class="btn btn-primary" (click)="onAddCard()">
                  <mat-icon>add</mat-icon>
                  Agregar Primera Tarjeta
                </button>
              </div>
            } @else {
              <app-card-list 
                [cards]="cards()"
                (editCard)="onEditCard($event)"
                (deleteCard)="onDeleteCard($event)"
                (setDefaultCard)="onSetDefaultCard($event)"
                (blockCard)="onBlockCard($event)"
                (cardStatusChanged)="onCardStatusChanged($event)"
                (viewCardDetail)="onViewCardDetail($event)">
              </app-card-list>
            }
          }

          @if (selectedTabIndex() === 1) {
            @if (creditCards().length === 0) {
              <div class="empty-state">
                <mat-icon class="empty-icon">credit_card_off</mat-icon>
                <h3>No tienes tarjetas de crédito</h3>
              </div>
            } @else {
              <app-card-list 
                [cards]="creditCards()"
                (editCard)="onEditCard($event)"
                (deleteCard)="onDeleteCard($event)"
                (setDefaultCard)="onSetDefaultCard($event)"
                (blockCard)="onBlockCard($event)"
                (cardStatusChanged)="onCardStatusChanged($event)"
                (viewCardDetail)="onViewCardDetail($event)">
              </app-card-list>
            }
          }

          @if (selectedTabIndex() === 2) {
            @if (debitCards().length === 0) {
              <div class="empty-state">
                <mat-icon class="empty-icon">payment_off</mat-icon>
                <h3>No tienes tarjetas de débito</h3>
              </div>
            } @else {
              <app-card-list 
                [cards]="debitCards()"
                (editCard)="onEditCard($event)"
                (deleteCard)="onDeleteCard($event)"
                (setDefaultCard)="onSetDefaultCard($event)"
                (blockCard)="onBlockCard($event)"
                (cardStatusChanged)="onCardStatusChanged($event)"
                (viewCardDetail)="onViewCardDetail($event)">
              </app-card-list>
            }
          }

          @if (selectedTabIndex() === 3) {
            <app-card-list 
              [cards]="activeCards()"
              (editCard)="onEditCard($event)"
              (deleteCard)="onDeleteCard($event)"
              (setDefaultCard)="onSetDefaultCard($event)"
              (blockCard)="onBlockCard($event)"
              (cardStatusChanged)="onCardStatusChanged($event)"
              (viewCardDetail)="onViewCardDetail($event)">
            </app-card-list>
          }
        </div>
      </div>
    }
  }

  <!-- Vista de Detalle de Tarjeta -->
  @if (viewMode() === 'detail' && selectedCard()) {
    <div class="detail-header">
      <button class="btn btn-secondary" (click)="onBackToList()">
        <mat-icon>arrow_back</mat-icon>
        Volver
      </button>
      <h1>Detalle de Tarjeta</h1>
      <button class="btn btn-outline" (click)="onEditCard(selectedCard()!)">
        Editar
      </button>
    </div>

    <app-card-detail [card]="selectedCard()!"></app-card-detail>
  }
</div>