<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    @if (currentUser(); as user) {
      <div>
        <h1>¡Bienvenido, {{ user.firstName }}!</h1>
        <p class="user-email">{{ user.email }}</p>
      </div>
    } @else {
      <h1>¡Bienvenido a FinTrack!</h1>
    }
  </div>

  <div class="dashboard-content">
    @if (loading()) {
      <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Cargando información del dashboard...</p>
      </div>
    } @else {
      
      <!-- Resumen Financiero - KPIs -->
      <div class="financial-summary">
        <div class="summary-cards">
          <!-- Balance ARS -->
          <mat-card class="balance-card ars-card" appearance="outlined">
            <mat-card-content>
              <div class="balance-header">
                <mat-icon class="balance-icon">account_balance_wallet</mat-icon>
                <div>
                  <h3>Balance ARS</h3>
                  <p>Pesos argentinos</p>
                </div>
              </div>
              <div class="balance-amount">
                <span class="amount">{{ totalWalletBalance() | currency:'ARS':'symbol':'1.2-2' }}</span>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Balance USD -->
          <mat-card class="balance-card usd-card" appearance="outlined">
            <mat-card-content>
              <div class="balance-header">
                <mat-icon class="balance-icon">attach_money</mat-icon>
                <div>
                  <h3>Balance USD</h3>
                  <p>Dólares americanos</p>
                </div>
              </div>
              <div class="balance-amount">
                <span class="amount">{{ totalWalletBalanceUSD() | currency:'USD':'symbol':'1.2-2' }}</span>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <!-- Transacciones Recientes -->
      <section class="recent-transactions-section">
        <mat-expansion-panel 
          [(expanded)]="transactionsPanelExpanded"
          class="transactions-panel">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="panel-title-content">
                <mat-icon fontIcon="receipt_long"></mat-icon>
                <h2>Transacciones Recientes</h2>
                <span class="transaction-count" *ngIf="recentTransactions().length > 0">
                  ({{ recentTransactions().length }})
                </span>
              </div>
            </mat-panel-title>
            <mat-panel-description>
              <button mat-button color="primary" [routerLink]="['/transactions']" (click)="$event.stopPropagation()">
                Ver todas
                <mat-icon fontIcon="arrow_forward"></mat-icon>
              </button>
            </mat-panel-description>
          </mat-expansion-panel-header>
        
          @if (loadingTransactions()) {
            <div class="loading-container">
              <mat-spinner diameter="30"></mat-spinner>
              <p>Cargando transacciones...</p>
            </div>
          } @else if (recentTransactions().length === 0) {
            <mat-card class="empty-transactions" appearance="outlined">
              <mat-card-content>
                <div class="empty-state">
                  <mat-icon class="empty-icon">receipt_long</mat-icon>
                  <h3>No hay transacciones recientes</h3>
                  <p>Cuando realices tu primera transacción, aparecerá aquí.</p>
                  <button mat-raised-button color="primary" [routerLink]="['/transactions']">
                    <mat-icon>add</mat-icon>
                    Nueva Transacción
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          } @else {
            <div class="transactions-list">
              @for (transaction of recentTransactions(); track transaction.id) {
                <mat-card class="transaction-item" appearance="outlined">
                  <mat-card-content>
                    <div class="transaction-content">
                      <div class="transaction-info">
                        <div class="transaction-icon" [ngClass]="'transaction-' + transaction.type.toLowerCase()">
                          <mat-icon>
                            {{ getTransactionIcon(transaction.type) }}
                          </mat-icon>
                        </div>
                        <div class="transaction-details">
                          <h4>{{ getAccountNameForTransaction(transaction) }}</h4>
                          <p class="transaction-description" *ngIf="transaction.description">
                            {{ transaction.description }}
                          </p>
                          <span class="transaction-date">
                            {{ transaction.createdAt | date:'short' }}
                          </span>
                        </div>
                      </div>
                      <div class="transaction-amount">
                        <span [class]="getTransactionAmount(transaction) > 0 ? 'amount-positive' : 'amount-negative'">
                          {{ transaction.amount | currency:transaction.currency }}
                        </span>
                        <span class="transaction-status" [class]="'status-' + transaction.status.toLowerCase()">
                          {{ transaction.status | titlecase }}
                        </span>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              }
            </div>
          }
        </mat-expansion-panel>
      </section>
    }
  </div>
</div>
