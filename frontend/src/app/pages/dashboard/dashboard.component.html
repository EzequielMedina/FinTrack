<div class="dashboard-container">
  <div class="dashboard-header">
    @if (currentUser(); as user) {
      <h1>¡Bienvenido, {{ user.firstName }}!</h1>
    } @else {
      <h1>¡Bienvenido a FinTrack!</h1>
    }
  </div>

  <div class="dashboard-content">
    @if (loading()) {
      <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Cargando información del dashboard...</p>
      </div>
    } @else {
      <!-- Resumen Financiero Principal -->
      <div class="financial-summary">
        <div class="summary-cards">
          <mat-card class="balance-card ars-card" appearance="outlined">
            <mat-card-content>
              <div class="balance-header">
                <mat-icon class="balance-icon">account_balance_wallet</mat-icon>
                <div>
                  <h3>Billeteras ARS</h3>
                  <p>Saldo total en pesos</p>
                </div>
              </div>
              <div class="balance-amount">
                <span class="amount">{{ totalWalletBalance() | currency:'ARS':'symbol':'1.2-2' }}</span>
              </div>
              <mat-card-actions align="end">
                <button mat-stroked-button color="primary" [routerLink]="['/accounts']">
                  <mat-icon>visibility</mat-icon>
                  Ver detalle
                </button>
              </mat-card-actions>
            </mat-card-content>
          </mat-card>

          <mat-card class="balance-card usd-card" appearance="outlined">
            <mat-card-content>
              <div class="balance-header">
                <mat-icon class="balance-icon">attach_money</mat-icon>
                <div>
                  <h3>Billeteras USD</h3>
                  <p>Saldo total en dólares</p>
                </div>
              </div>
              <div class="balance-amount">
                <span class="amount">{{ totalWalletBalanceUSD() | currency:'USD':'symbol':'1.2-2' }}</span>
              </div>
              <mat-card-actions align="end">
                <button mat-stroked-button color="accent" [routerLink]="['/accounts']">
                  <mat-icon>visibility</mat-icon>
                  Ver detalle
                </button>
              </mat-card-actions>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <!-- Tarjetas de Información -->
      <div class="info-cards">
        <mat-card class="info-card accounts-info" appearance="outlined">
          <mat-card-header>
            <div mat-card-avatar class="card-avatar accounts-avatar">
              <mat-icon>account_balance</mat-icon>
            </div>
            <mat-card-title>Mis Cuentas</mat-card-title>
            <mat-card-subtitle>{{ activeAccountsCount() }} cuentas activas</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="info-content">
              <p>Gestiona todas tus cuentas bancarias y billeteras digitales desde un solo lugar.</p>
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-flat-button color="primary" [routerLink]="['/accounts']">
              <mat-icon>settings</mat-icon>
              Gestionar Cuentas
            </button>
          </mat-card-actions>
        </mat-card>

        <mat-card class="info-card credit-info" appearance="outlined">
          <mat-card-header>
            <div mat-card-avatar class="card-avatar credit-avatar">
              <mat-icon>credit_card</mat-icon>
            </div>
            <mat-card-title>Límite de Crédito</mat-card-title>
            <mat-card-subtitle>{{ totalCreditLimit() | currency:'ARS':'symbol':'1.0-0' }} disponible</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="info-content">
              <p>Tu límite total de crédito disponible en todas tus tarjetas.</p>
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-flat-button color="accent" [routerLink]="['/cards']">
              <mat-icon>credit_card</mat-icon>
              Ver Tarjetas
            </button>
          </mat-card-actions>
        </mat-card>

        <mat-card class="info-card transactions-info" appearance="outlined">
          <mat-card-header>
            <div mat-card-avatar class="card-avatar transactions-avatar">
              <mat-icon>swap_horiz</mat-icon>
            </div>
            <mat-card-title>Transacciones</mat-card-title>
            <mat-card-subtitle>{{ transactionsCount() }} este mes</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="info-content">
              <p>Revisa tu historial de transacciones y movimientos recientes.</p>
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-flat-button color="warn">
              <mat-icon>history</mat-icon>
              Ver Historial
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    }

    <!-- Quick Actions -->
    <section class="quick-actions">
      <h3>Acciones Rápidas</h3>
      <div class="actions-grid">
        <!-- Acciones para todos los usuarios -->
        <button mat-fab extended color="primary" class="action-button">
          <mat-icon>add</mat-icon>
          Nueva Transacción
        </button>
        <button mat-fab extended color="accent" class="action-button" [routerLink]="['/accounts']">
          <mat-icon>account_balance</mat-icon>
          Gestionar Cuentas
        </button>
        <button mat-fab extended color="accent" class="action-button" [routerLink]="['/cards']">
          <mat-icon>credit_card</mat-icon>
          Gestionar Tarjetas
        </button>
        <button mat-fab extended class="action-button">
          <mat-icon>file_download</mat-icon>
          Exportar Datos
        </button>
        
        <!-- Acciones exclusivas para administradores -->
        <button mat-fab extended color="warn" class="action-button" 
                [routerLink]="['/admin']"
                *appHasPermission="Permission.ADMIN_PANEL_ACCESS">
          <mat-icon>admin_panel_settings</mat-icon>
          Panel de Administración
        </button>
        
        <button mat-fab extended color="warn" class="action-button"
                [routerLink]="['/admin/users']"
                *appHasPermission="Permission.USER_READ">
          <mat-icon>people</mat-icon>
          Gestionar Usuarios
        </button>
      </div>
    </section>
    
    <!-- Sección especial para Administradores -->
    <section class="admin-section" *appHasRole="UserRole.ADMIN">
      <h3>Funciones de Administrador</h3>
      <mat-grid-list cols="3" rowHeight="150px" gutterSize="16px" class="admin-grid">
        <mat-grid-tile>
          <mat-card class="admin-card" [routerLink]="['/admin/users']">
            <mat-card-header>
              <mat-icon mat-card-avatar class="admin-icon">people</mat-icon>
              <mat-card-title>Usuarios</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p>Crear, editar y gestionar usuarios del sistema</p>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
        
        <mat-grid-tile>
          <mat-card class="admin-card" [routerLink]="['/admin']">
            <mat-icon mat-card-avatar class="admin-icon">dashboard</mat-icon>
            <mat-card-title>Panel Admin</mat-card-title>
            <mat-card-content>
              <p>Dashboard completo de administración</p>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
        
        <mat-grid-tile>
          <mat-card class="admin-card" *appHasPermission="Permission.REPORTS_VIEW">
            <mat-icon mat-card-avatar class="admin-icon">analytics</mat-icon>
            <mat-card-title>Reportes Avanzados</mat-card-title>
            <mat-card-content>
              <p>Análisis y reportes del sistema</p>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
      </mat-grid-list>
    </section>
  </div>
</div>
