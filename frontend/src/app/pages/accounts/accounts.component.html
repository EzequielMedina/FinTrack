<div class="accounts-container">
  <div class="accounts-header">
    <h1>Gestión de Cuentas</h1>
    <div class="header-actions">
      <button mat-fab extended color="primary" (click)="onAddAccount()">
        <mat-icon>add</mat-icon>
        Crear Cuenta
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Cargando cuentas...</p>
    </div>
  } @else {
    <div class="accounts-content">
      <!-- Summary Cards -->
      <div class="summary-grid">
        <mat-card class="summary-card balance">
          <mat-card-header>
            <mat-icon mat-card-avatar class="summary-icon balance">account_balance</mat-icon>
            <mat-card-title>Saldo Total (ARS)</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="summary-number">{{ totalBalanceFormatted }}</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="summary-card credit">
          <mat-card-header>
            <mat-icon mat-card-avatar class="summary-icon credit">credit_card</mat-icon>
            <mat-card-title>Límite de Crédito Total</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="summary-number">{{ totalCreditLimitFormatted }}</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="summary-card usd">
          <mat-card-header>
            <mat-icon mat-card-avatar class="summary-icon usd">attach_money</mat-icon>
            <mat-card-title>Saldo USD</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="summary-number">{{ totalUsdBalanceFormatted }}</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="summary-card accounts">
          <mat-card-header>
            <mat-icon mat-card-avatar class="summary-icon accounts">account_balance_wallet</mat-icon>
            <mat-card-title>Total de Cuentas</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="summary-number">{{ accountsCount }}</div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Tabs for different views -->
      <mat-card class="accounts-list-card">
        <mat-tab-group (selectedTabChange)="onTabChanged($event.index)" [selectedIndex]="selectedTabIndex()">
          <mat-tab label="Todas las Cuentas">
            <div class="tab-content">
              @if (accounts().length === 0) {
                <div class="empty-state">
                  <mat-icon class="empty-icon">account_balance_wallet</mat-icon>
                  <h3>No tienes cuentas registradas</h3>
                  <p>Crea tu primera cuenta para comenzar a gestionar tu dinero</p>
                  <button mat-raised-button color="primary" (click)="onAddAccount()">
                    <mat-icon>add</mat-icon>
                    Crear Primera Cuenta
                  </button>
                </div>
              } @else {
                <app-account-list 
                  [accounts]="accounts()"
                  (editAccount)="onEditAccount($event)"
                  (deleteAccount)="onDeleteAccount($event)"
                  (activateAccount)="onActivateAccount($event)"
                  (manageWallet)="onManageWallet($event)"
                  (manageCredit)="onManageCredit($event)"
                  (accountStatusChanged)="onAccountStatusChanged($event)">
                </app-account-list>
              }
            </div>
          </mat-tab>

          <mat-tab label="Cuentas de Ahorro">
            <div class="tab-content">
              @if (savingsAccounts.length === 0) {
                <div class="empty-state">
                  <mat-icon class="empty-icon">savings</mat-icon>
                  <h3>No tienes cuentas de ahorro</h3>
                  <p>Crea una cuenta de ahorro para empezar a ahorrar</p>
                </div>
              } @else {
                <app-account-list 
                  [accounts]="savingsAccounts"
                  (editAccount)="onEditAccount($event)"
                  (deleteAccount)="onDeleteAccount($event)"
                  (activateAccount)="onActivateAccount($event)"
                  (manageWallet)="onManageWallet($event)"
                  (manageCredit)="onManageCredit($event)"
                  (accountStatusChanged)="onAccountStatusChanged($event)">
                </app-account-list>
              }
            </div>
          </mat-tab>

          <mat-tab label="Cuentas Corrientes">
            <div class="tab-content">
              @if (checkingAccounts.length === 0) {
                <div class="empty-state">
                  <mat-icon class="empty-icon">account_balance</mat-icon>
                  <h3>No tienes cuentas corrientes</h3>
                  <p>Crea una cuenta corriente para tus transacciones diarias</p>
                </div>
              } @else {
                <app-account-list 
                  [accounts]="checkingAccounts"
                  (editAccount)="onEditAccount($event)"
                  (deleteAccount)="onDeleteAccount($event)"
                  (activateAccount)="onActivateAccount($event)"
                  (manageWallet)="onManageWallet($event)"
                  (manageCredit)="onManageCredit($event)"
                  (accountStatusChanged)="onAccountStatusChanged($event)">
                </app-account-list>
              }
            </div>
          </mat-tab>

          <mat-tab label="Tarjetas de Crédito">
            <div class="tab-content">
              @if (creditCards.length === 0) {
                <div class="empty-state">
                  <mat-icon class="empty-icon">credit_card</mat-icon>
                  <h3>No tienes tarjetas de crédito</h3>
                  <p>Solicita una tarjeta de crédito para realizar compras a crédito</p>
                </div>
              } @else {
                <app-account-list 
                  [accounts]="creditCards"
                  (editAccount)="onEditAccount($event)"
                  (deleteAccount)="onDeleteAccount($event)"
                  (activateAccount)="onActivateAccount($event)"
                  (manageWallet)="onManageWallet($event)"
                  (manageCredit)="onManageCredit($event)"
                  (accountStatusChanged)="onAccountStatusChanged($event)">
                </app-account-list>
              }
            </div>
          </mat-tab>

          <mat-tab label="Cuentas USD">
            <div class="tab-content">
              @if (usdAccounts.length === 0) {
                <div class="empty-state">
                  <mat-icon class="empty-icon">attach_money</mat-icon>
                  <h3>No tienes cuentas en dólares</h3>
                  <p>Crea una cuenta en dólares para operaciones en moneda extranjera</p>
                </div>
              } @else {
                <app-account-list 
                  [accounts]="usdAccounts"
                  (editAccount)="onEditAccount($event)"
                  (deleteAccount)="onDeleteAccount($event)"
                  (activateAccount)="onActivateAccount($event)"
                  (manageWallet)="onManageWallet($event)"
                  (manageCredit)="onManageCredit($event)"
                  (accountStatusChanged)="onAccountStatusChanged($event)">
                </app-account-list>
              }
            </div>
          </mat-tab>

          <mat-tab label="Activas">
            <div class="tab-content">
              @if (activeAccounts.length === 0) {
                <div class="empty-state">
                  <mat-icon class="empty-icon">check_circle</mat-icon>
                  <h3>No tienes cuentas activas</h3>
                  <p>Activa al menos una cuenta para comenzar a operar</p>
                </div>
              } @else {
                <app-account-list 
                  [accounts]="activeAccounts"
                  (editAccount)="onEditAccount($event)"
                  (deleteAccount)="onDeleteAccount($event)"
                  (activateAccount)="onActivateAccount($event)"
                  (manageWallet)="onManageWallet($event)"
                  (manageCredit)="onManageCredit($event)"
                  (accountStatusChanged)="onAccountStatusChanged($event)">
                </app-account-list>
              }
            </div>
          </mat-tab>

          <mat-tab label="Inactivas">
            <div class="tab-content">
              @if (inactiveAccounts.length === 0) {
                <div class="empty-state">
                  <mat-icon class="empty-icon">cancel</mat-icon>
                  <h3>No tienes cuentas inactivas</h3>
                  <p>Todas tus cuentas están activas</p>
                </div>
              } @else {
                <app-account-list 
                  [accounts]="inactiveAccounts"
                  (editAccount)="onEditAccount($event)"
                  (deleteAccount)="onDeleteAccount($event)"
                  (activateAccount)="onActivateAccount($event)"
                  (manageWallet)="onManageWallet($event)"
                  (manageCredit)="onManageCredit($event)"
                  (accountStatusChanged)="onAccountStatusChanged($event)">
                </app-account-list>
              }
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card>
    </div>
  }
</div>